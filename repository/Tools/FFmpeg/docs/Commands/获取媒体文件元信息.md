# 获取媒体文件元信息

---

!> 该文档内容待补充 **TODO**
## 媒体文件的元信息

文件的元信息即文件内容的描述信息, 包含了文件内容的存储方式, 大小, 格式等, 它并不会反应文件的实际内容.

媒体文件的元信息以视频文件为例, 包括但不限于以下部分:

- 流信息
- 帧信息
- 包信息
- 格式信息

## 如何读取媒体文件的元信息

FFmpeg提供的FFprobe, 就是用于获取媒体文件元信息的探针工具

FFprobe基础获取文件元信息命令:

```bash
ffprobe \
[-v, -loglevel <log_level>] \
[-of, -print_format <print_format>] \
[-show_streams] \
[-show_format] \
[-show_frames] \
[-show_entries <section_entries>] \
[-show_packets] \
-i <input>
```

参数说明:

|参数|必须参数|说明|值|默认值|
|:-|:-|:-|:-|:-|
|-v, -loglevel|N|设置输出信息的日志级别|参考: [LogLevel](#loglevel)|info \| 32|
|-of, -print_format|N|设置输出信息的格式|参考: [PrintFormat](#printformat)|default|
|-show_streams|N|设置输出流信息|指定该参数即生效, 不指定则为不生效|false|
|-show_format|N|设置输出格式信息|指定该参数即生效, 不指定则为不生效|false|
|-show_frames|N|设置输出帧信息|指定该参数即生效, 不指定则为不生效|false|
|-show_entries|N|设置输出信息的字段|参考: [ShowEntries](#showentries)|无|
|-show_packets|N|设置输出打包信息|指定该参数即生效, 不指定则为不生效|false|
|-i|Y|设置输入文件或流|值可以为文件路径或流的URL|无|


## 详细参数说明

### LogLevel

LogLevel 参数的值为以下枚举值之一, 命令中可以使用枚举名称也可以使用枚举名称对应的值:

- quiet, -8
- panic, 0
- fatal, 8
- error, 16
- warning, 24
- info, 32
- verbose, 40
- debug, 48
- trace, 56

从上往下, 值越大, 日志输出级别越低, 相同的命令参数, 输出的日志内容越多

### PrintFormat

PrintFormat 参数的值为以下枚举值之一

示例:

```bash
ffprobe -of default
# or
ffprobe -of json
```

#### default

此为FFprobe输出的**默认格式**, 输出样式大致如下:

```bash
[FORMAT]
filename=output.mp4
nb_streams=1
nb_programs=0
format_name=mov,mp4,m4a,3gp,3g2,mj2
format_long_name=QuickTime / MOV
start_time=0.000000
duration=10.234000
size=15797948
bit_rate=12349382
probe_score=100
TAG:major_brand=isom
TAG:minor_version=512
TAG:compatible_brands=isomiso2avc1mp41
TAG:encoder=Lavf59.10.100
[/FORMAT]
```

default输出格式有以下可选参数:

##### nokey, nk

设置是否输出属性字段的名称, 即是否输出 [示例](#default) 中属性列表中"="及其前面的部分, 可选值: 0 | 1, 默认值: 0, 0为**输出**字段名称, 1为**不输出**字段名称

示例:

```bash
ffprobe -of default=nk=1
# or
ffprobe -of default=nokey=1
```

输出示例:

```bash
[FORMAT]
output.mp4
1
0
mov,mp4,m4a,3gp,3g2,mj2
QuickTime / MOV
0.000000
10.234000
15797948
12349382
100
isom
512
isomiso2avc1mp41
Lavf59.10.100
[/FORMAT]
```

##### noprint_wrappers, nw

设置是否输出属性分类名称, 即设置是否输出 [示例](#default) 中, "[FORMAT]" 和 "[/FORMAT]" 所在的行, 可选值: 0 | 1, 默认值: 0, 0为**输出**属性分类名称, 1为**不输出**属性分类名称

示例:

```bash
ffprobe -of default=noprint_wrappers=1
# or
ffprobe -of default=nw=1
```

输出示例:

```bash
filename=output.mp4
nb_streams=1
nb_programs=0
format_name=mov,mp4,m4a,3gp,3g2,mj2
format_long_name=QuickTime / MOV
start_time=0.000000
duration=10.234000
size=15797948
bit_rate=12349382
probe_score=100
TAG:major_brand=isom
TAG:minor_version=512
TAG:compatible_brands=isomiso2avc1mp41
TAG:encoder=Lavf59.10.100
```

#### csv

csv输出格式大致如下:

```bash
format,output.mp4,1,0,"mov,mp4,m4a,3gp,3g2,mj2",QuickTime / MOV,0.000000,10.234000,15797948,12349382,100,isom,512,isomiso2avc1mp41,Lavf59.10.100
```

csv输出格式有以下可选参数:

##### item_sep, s
##### nokey, nk
##### escape, e
##### print_section, p

#### flat

flat输出格式大致如下:

```bash
format.filename="output.mp4"
format.nb_streams=1
format.nb_programs=0
format.format_name="mov,mp4,m4a,3gp,3g2,mj2"
format.format_long_name="QuickTime / MOV"
format.start_time="0.000000"
format.duration="10.234000"
format.size="15797948"
format.bit_rate="12349382"
format.probe_score=100
format.tags.major_brand="isom"
format.tags.minor_version="512"
format.tags.compatible_brands="isomiso2avc1mp41"
format.tags.encoder="Lavf59.10.100"
```

flat输出格式有以下可选参数:

##### sep_char, s
##### hierarchical, h

#### ini

ini输出格式大致如下:

```bash
# ffprobe output

[format]
filename=output.mp4
nb_streams=1
nb_programs=0
format_name=mov,mp4,m4a,3gp,3g2,mj2
format_long_name=QuickTime / MOV
start_time=0.000000
duration=10.234000
size=15797948
bit_rate=12349382
probe_score=100

[format.tags]
major_brand=isom
minor_version=512
compatible_brands=isomiso2avc1mp41
encoder=Lavf59.10.100
```

ini输出格式有以下可选参数:

##### hierarchical, h


#### json

json输出格式大致如下:

```bash
{
    "format": {
        "filename": "output.mp4",
        "nb_streams": 1,
        "nb_programs": 0,
        "format_name": "mov,mp4,m4a,3gp,3g2,mj2",
        "format_long_name": "QuickTime / MOV",
        "start_time": "0.000000",
        "duration": "10.234000",
        "size": "15797948",
        "bit_rate": "12349382",
        "probe_score": 100,
        "tags": {
            "major_brand": "isom",
            "minor_version": "512",
            "compatible_brands": "isomiso2avc1mp41",
            "encoder": "Lavf59.10.100"
        }
    }
}
```

json输出格式包含以下可选参数:

##### compact, c

设置是否压缩json输出信息, 即将输出的json数据中的换行, 空格等空白字符进行压缩去除, 减小输出体积, 可选值: 0 | 1, 默认值: 0, 0为**不压缩**输出信息, 1为**压缩**输出信息

示例:

```bash
ffprobe -of json=c=1
# or
ffprobe -of json=compact=1
```

输出示例:

```bash
{
    "format": { "filename": "output.mp4", "nb_streams": 1, "nb_programs": 0, "format_name": "mov,mp4,m4a,3gp,3g2,mj2", "format_long_name": "QuickTime / MOV", "start_time": "0.000000", "duration": "10.234000", "size": "15797948", "bit_rate": "12349382", "probe_score": 100,
        "tags": { "major_brand": "isom", "minor_version": "512", "compatible_brands": "isomiso2avc1mp41", "encoder": "Lavf59.10.100" } }
}
```

#### xml

xml输出格式大致如下:

```bash
<?xml version="1.0" encoding="UTF-8"?>
<ffprobe>
    <format filename="output.mp4" nb_streams="1" nb_programs="0" format_name="mov,mp4,m4a,3gp,3g2,mj2" format_long_name="QuickTime / MOV" start_time="0.000000" duration="10.234000" size="15797948" bit_rate="12349382" probe_score="100">
        <tag key="major_brand" value="isom"/>
        <tag key="minor_version" value="512"/>
        <tag key="compatible_brands" value="isomiso2avc1mp41"/>
        <tag key="encoder" value="Lavf59.10.100"/>
    </format>
</ffprobe>
```

xml输出格式有以下可选参数:

##### fully_qualified, q
##### xsd_compliant, x

### ShowEntries

<!-- Set list of entries to show.

Entries are specified according to the following syntax. section_entries contains a list of section entries separated by :. Each section entry is composed by a section name (or unique name), optionally followed by a list of entries local to that section, separated by ,.

If section name is specified but is followed by no =, all entries are printed to output, together with all the contained sections. Otherwise only the entries specified in the local section entries list are printed. In particular, if = is specified but the list of local entries is empty, then no entries will be shown for that section.

Note that the order of specification of the local section entries is not honored in the output, and the usual display order will be retained.

The formal syntax is given by:

 	
LOCAL_SECTION_ENTRIES ::= SECTION_ENTRY_NAME[,LOCAL_SECTION_ENTRIES]
SECTION_ENTRY         ::= SECTION_NAME[=[LOCAL_SECTION_ENTRIES]]
SECTION_ENTRIES       ::= SECTION_ENTRY[:SECTION_ENTRIES]
For example, to show only the index and type of each stream, and the PTS time, duration time, and stream index of the packets, you can specify the argument:

 	
packet=pts_time,duration_time,stream_index : stream=index,codec_type
To show all the entries in the section "format", but only the codec type in the section "stream", specify the argument:

 	
format : stream=codec_type
To show all the tags in the stream and format sections:

 	
stream_tags : format_tags
To show only the title tag (if available) in the stream sections:

 	
stream_tags=title -->


## FFprobe输出的元信息字段解读

[FFprobe媒体文件元信息解读](/repository/Tools/FFmpeg/docs/FFprobe媒体文件元信息解读.md)